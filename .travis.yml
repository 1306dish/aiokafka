language: python
sudo: required
services:
- docker
branches:
  only:
  - master
  - v0.2
  - "/^v\\d+\\.\\d+\\.\\d+$/"
  - "/^v\\d+\\.\\d+\\.\\d+\\.dev\\d*$/"
python:
# - 3.3
# - 3.4
- 3.6
env:
  matrix:
  # - KAFKA_VERSION=0.9.0.1 SCALA_VERSION=2.11 PYTHONASYNCIODEBUG=1
  # - KAFKA_VERSION=0.9.0.1 SCALA_VERSION=2.11 PYTHONASYNCIODEBUG=1 AIOKAFKA_NO_EXTENSIONS=1
  # - KAFKA_VERSION=0.10.2.1 SCALA_VERSION=2.11 PYTHONASYNCIODEBUG=1
  # - KAFKA_VERSION=0.10.2.1 SCALA_VERSION=2.11 PYTHONASYNCIODEBUG=1 AIOKAFKA_NO_EXTENSIONS=1
  - KAFKA_VERSION=0.11.0.0 SCALA_VERSION=2.12 PYTHONASYNCIODEBUG=1
  # - KAFKA_VERSION=0.11.0.0 SCALA_VERSION=2.12 PYTHONASYNCIODEBUG=1 AIOKAFKA_NO_EXTENSIONS=1
before_install:
- sudo apt-get update
- sudo apt-get install -y libsnappy-dev
install:
- pip install --upgrade pip setuptools wheel
- pip install flake8
- pip install "pytest<3.3.0" pytest-cov pytest-catchlog docker-py
- pip install codecov
- pip install cython
- pip install python-snappy
- pip install lz4 xxhash
- pip install pathlib
- pip install -vv -Ue .
script:
- make cov FLAGS="-v -k test_client"
after_success:
- codecov
deploy:
  provider: pypi
  user: aio-libs-bot
  password:
    secure: DHY5vj7M2FUNGuFSTqaQ6npeZwonptj0VHffzOMMJIyp0jGi4Z7TSqysXk+iznPHa94W6iOUgryCSvKyIEWK74HzXs6UghI4iU9QTZFAX9S3AjLTki5spR3k4VAliWBeI5yIVnRiPlb+EhiYoH1oO3t9BT+fqf59L8nxSQo5H1VipzPQ7TLpQsdeMLFdvQt8QzTMfiaAL69BoWUxShI2psUwbRKaCV8c/wJTdjBRcI7z8FGz+t0Qqg3ZDQySBQZ5Tz6SIFAXO4CxGemQFNhL0UoK8d0iiV3eAQZmVtnDxM/mcLsEpd79iHowFF6gH/ytM4xJiX5o4JOGHtqk4HIXNtlMews6JwSzrrCDYRmv9elFVXE1oDJJq19D5zhSqM+keHTUA5Ta1B8/eChcR9wDYA2etEvjKUxaMfcImLYv5ZSNVjziz0pvgL8GbuLwws/OAyEGTZjrHi0LxURibIXCHzJu46F5XB06ozvsf+YrldFyr24q+ABNe/NsJ5YxvGosGCBJ0aDl+On9Wqe4TGOayIMpo9MeDrifBqfFcssVYSr1D+ZaEtzihZXFRWxVR/IL9OTuiCDNo+ozTM7mjjQyJpDDXHmfNJ5MIIYV2QJFSNTLfiWOnRZ9S3Z21x8CfOX485c7iCUlKnEvGWIEuJ1Tslb7a8LuoMpl7ohKO960dNo=
  distributions: sdist
  on:
    tags: true
    all_branches: true
    python: 3.6
